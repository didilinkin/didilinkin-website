---
title: ä½¿ç”¨ GitHub Actions æ„å»ºã€éƒ¨ç½² Next.js å¹¶å°†å…¶æ‰˜ç®¡åˆ° GitHub Pages
authors: [didilinkin]
tags: [
  Next.js,
  GitHub Actions,
  GitHub Pages,
  CI / CD,
]
slug: using-github-actions-build-deploy-and-host-nextjs-to-gitHub-pages
description: ä½¿ç”¨ GitHub Actions æ„å»ºã€éƒ¨ç½² Next.js å¹¶å°†å…¶æ‰˜ç®¡åˆ° GitHub Pages
image: ./img/updated-Main-icon@3x.webp
---

æœ¬æ–‡æ˜¯ä¸€ä¸ªç®€å•æ•™ç¨‹, å°† `Next.js` åˆ¶ä½œçš„é™æ€ç½‘ç«™, é€šè¿‡ `GitHub Actions`æ„å»ºæ‰“åŒ…ï¼Œæœ€åå°†å…¶è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° `GitHub Pages`ç”¨äºå±•ç¤º

<!--truncate-->

![](./img/updated-Main-icon@3x.webp)

<br />

## ä»‹ç»:

* [GitHub Actions](https://github.com/features/actions) æ˜¯ GitHubçš„æŒç»­é›†æˆæœåŠ¡

* [Github Pages](https://docs.github.com/en/pages) æ˜¯ GitHubçš„é™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡

* [Next.js](https://nextjs.org/) æ˜¯ åŸºäº Reactæ„å»º æœåŠ¡ç«¯æ¸²æŸ“ (SSR)åº”ç”¨çš„æ¡†æ¶

### åœ¨æœ¬æ•™ç¨‹ä¸­çš„æ­¥éª¤:

1. å°†æœ¬åœ°å¼€å‘å¥½çš„ `Next.js`é¡¹ç›®ä¸Šä¼ åˆ° GitHub, å¯ç”¨ `GitHub Pages`æœåŠ¡

2. é…ç½® `GitHub Actions` workflow, ä»¥ä¾¿åœ¨ pushæ—¶è‡ªåŠ¨æ„å»ºã€å¯¼å‡ºå’Œéƒ¨ç½² é™æ€ç½‘ç«™åˆ° `GitHub Pages`

3. ä¿®æ”¹ `Next.js`çš„é…ç½®é€‰é¡¹ä»¥é€‚åº” `GitHub Actions` URLç»“æ„

<br />
































## 1. é…ç½® GitHub Pages

GitHub Pages å¿…é¡»åœ¨æ¯ä¸ª repo çš„åŸºç¡€ä¸Šæ‰“å¼€, æ‰“å¼€å®ƒæ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦æœåŠ¡çš„åˆ†æ”¯

é€šå¸¸æ˜¯å°†æœåŠ¡è®¾ç½®åœ¨ `.gh-pages`åˆ†æ”¯

1. åœ¨æµè§ˆå™¨ä¸­, æ‰“å¼€ GitHub é‡Œçš„é¡¹ç›® repo

2. åœ¨ `Settings > Pages > Source`ä¸­, å°† `Branch`åˆ†æ”¯è®¾å®šåœ¨ `.gh-pages` å¹¶ç‚¹å‡» `Save`ä¿å­˜é…ç½®

![](./img/WX20230409-131938.png)

<br />





























































## 2. é…ç½® GitHub Actions

GitHub Actions æ˜¯ä¸€ç§å·¥å…·ï¼Œå¯è®©ä½ åœ¨ GitHub ä»“åº“ä¸­æ‰§è¡Œä¸åŒçš„è‡ªåŠ¨åŒ–æ“ä½œ

å®ƒå…è®¸ä½ åˆ›å»º è‡ªå®šä¹‰å·¥ä½œæµï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥ä½œæµæ¥è‡ªåŠ¨åŒ–å¼€å‘è¿‡ç¨‹ï¼Œä¾‹å¦‚ æ„å»ºã€ æµ‹è¯• å’Œ éƒ¨ç½²ä»£ç 

![](./img/WX20230328-202800@2x.png)

<br />

### 2.1 å¦‚ä½•åœ¨ä»“åº“ä¸­è®¾ç½® GitHub Actions

GitHub Actions çš„é…ç½®æ–‡ä»¶å«åš `workflow` æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ä»£ç ä»“åº“çš„ `.github/workflows`ç›®å½•

`workflow` æ–‡ä»¶é‡‡ç”¨ YAML æ ¼å¼, æ–‡ä»¶åå¯ä»¥ä»»æ„å–, ä½†æ˜¯åç¼€åç»Ÿä¸€ä¸º`.yml`, æ¯”å¦‚ `actions.yml`

ä¸€ä¸ªåº“å¯ä»¥æœ‰å¤šä¸ª `workflow` æ–‡ä»¶, GitHub åªè¦å‘ç° `.github/workflows` ç›®å½•é‡Œé¢æœ‰ `*.yml`æ–‡ä»¶, å°±ä¼šè‡ªåŠ¨è¿è¡Œè¯¥æ–‡ä»¶

<br />

### 2.2 GitHub Actions å­—æ®µ

* `name`: name å­—æ®µæ˜¯ workflow çš„åç§°ã€‚å¦‚æœçœç•¥è¯¥å­—æ®µï¼Œé»˜è®¤ä¸ºå½“å‰ workflow çš„æ–‡ä»¶å

* `on`: on å­—æ®µæŒ‡å®šè§¦å‘ workflow çš„æ¡ä»¶ï¼Œé€šå¸¸æ˜¯æŸäº›äº‹ä»¶

* `on.<push|pull_request>.<tags|branches>`: æŒ‡å®šè§¦å‘äº‹ä»¶æ—¶ï¼Œå¯ä»¥é™å®šåˆ†æ”¯æˆ–æ ‡ç­¾

* `jobs.<job_id>.name`: workflow æ–‡ä»¶çš„ä¸»ä½“æ˜¯jobså­—æ®µ, è¡¨ç¤ºè¦æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡

* `jobs.<job_id>.needs`: needs å­—æ®µæŒ‡å®šå½“å‰ä»»åŠ¡çš„ä¾èµ–å…³ç³», å³è¿è¡Œé¡ºåº

* `jobs.<job_id>.runs-on`: runs-on å­—æ®µæŒ‡å®šè¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒ, å®ƒæ˜¯å¿…å¡«å­—æ®µ

* `jobs.<job_id>.steps`: steps å­—æ®µæŒ‡å®šæ¯ä¸ª Job çš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤, æ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥æŒ‡å®šä»¥ä¸‹ä¸‰ä¸ªå­—æ®µ

<br />

### 2.3 ä½¿ç”¨åˆ°çš„è„šæœ¬

* [Setup Node.js environment: é…ç½® Node.jsç¯å¢ƒ](https://github.com/marketplace/actions/setup-node-js-environment)
* [Setup pnpm: é…ç½® Pnpmå®‰è£…ä¾èµ–](https://github.com/marketplace/actions/setup-pnpm)
* [Deploy to GitHub Pages: æä¾› éƒ¨ç½²èƒ½åŠ›](https://github.com/marketplace/actions/deploy-to-github-pages)
  * [Optional å‚æ•°è¯´æ˜](https://github.com/marketplace/actions/deploy-to-github-pages#optional-choices)

<br />

### 2.4 å®Œæ•´çš„é…ç½®

```yaml title=".github/workflows/actions.yml" showLineNumbers
name: Actions CI - Next.js version 12 static site export, GitHub Actions Build and Deploy
on:
  push:
    branches: [ main ]
# æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡
jobs:
  build-and-deploy:
    # è¿è¡Œåœ¨è™šæ‹Ÿæœºç¯å¢ƒubuntu-latest
    # https://docs.github.com/zh/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idruns-on
    runs-on: ubuntu-latest
    steps:
    - name: è·å–æºç   ğŸ›ï¸
      uses: actions/checkout@v3
    - name: Nodeç¯å¢ƒç‰ˆæœ¬ ğŸ—œï¸
      uses: actions/setup-node@v3
      with:
        node-version: 18
    - name: å®‰è£… Pnpm ğŸ§¬
      uses: pnpm/action-setup@v2
      id: pnpm-install
      with:
          version: 7
          run_install: true
    - name: å®‰è£…ä¾èµ– âš™ï¸
      run: pnpm install
    - name: æ‰“åŒ… ğŸ—ï¸
      run: |
        npm run build
        touch out/.nojekyll
    - name: éƒ¨ç½² ğŸš€
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: out
        clean: true
```

<br />

### 2.5 VS Code å¼€å‘ä½“éªŒä¼˜åŒ–

é€šè¿‡å®‰è£… VS Codeå®˜æ–¹æ’ä»¶ [Github Actions](https://marketplace.visualstudio.com/items?itemName=github.vscode-github-actions)æ¥æ›´ç›´è§‚çš„ ç®¡ç†å·¥ä½œæµã€æŸ¥çœ‹å·¥ä½œæµ è¿è¡Œå†å²è®°å½•å¹¶å¸®åŠ© åˆ›ä½œå·¥ä½œæµ

æ’ä»¶é…ç½® **æ³¨æ„äº‹é¡¹**:

1. è®¾ç½® `VS Code`ç¼–è¾‘å™¨ç™»å½• `GitHub`è´¦å·, å¹¶ä¸”ç»‘å®š
2. å°† `remote`åç§° è®¾ç½®ä¸ºä¸Šä¼  GitHubçš„ `remote`åç§°, é»˜è®¤å€¼: `origin`

![](./img/WX20230406-235756@2x.png)

<br />

3. å‹¾é€‰ä¸Šå›¾ `Auto-refresh` è‡ªåŠ¨åˆ·æ–°, å¯ä»¥å®æ—¶æŸ¥çœ‹ `workflow`å·¥ä½œæµçŠ¶æ€

![](./img/WX20230407-014722@2x.png)

<br />






























































## 3. é…ç½® Next.js

### 3.1 é…ç½®è·¯å¾„

Next.jsçš„ `next/image`ã€`next/link` å’Œ `next/router` æŒ‡å®šè·¯å¾„æ˜¯ç›¸å¯¹äº `/`çš„

è€Œ GitHub Pages æ‰˜ç®¡ç«™ç‚¹çš„URLä¸º: `https://<ä½ çš„github name>.github.io/<repo>`

> å¦‚: `https://didilinkin.github.io/next-static-site-antd/`

æ‰€ä»¥ éœ€è¦é€šè¿‡é…ç½®ä½¿ Next.js å¾—åˆ° `/<repo>`

æœ‰ä¸¤ä¸ªç›¸å…³çš„é…ç½®é€‰é¡¹: [basePath](https://nextjs.org/docs/api-reference/next.config.js/basepath) å’Œ [assetPrefix](https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix)

å°† `basePath` è®¾ç½®ä¸º `/<repo name>` å°†ç”Ÿæˆ GitHub Pages å¯è®¿é—®é“¾æ¥

å°† `assetPrefix` è®¾ç½®ä¸º `/<repo name>/` å°†ç”Ÿæˆ GitHub Pages å¯è®¿é—®å›¾åƒ

<br />

```js title="next.config.js"
const repo = 'change-me-to-your-repo'
const assetPrefix = `/${repo}/`
const basePath = `/${repo}`

module.exports = {
  assetPrefix: assetPrefix,
  basePath: basePath,
}
```

<br />

è®©æˆ‘ä»¬å°†è¿™éƒ¨åˆ†é…ç½®åº”ç”¨äº GitHub Pages

æˆ‘ä»¬ä¼šé€šè¿‡ä½¿ç”¨ GitHub Actions å¯¼å‡ºé™æ€ç½‘ç«™ æ‹·è´åˆ° GitHub Pages (è¯¦æƒ…å¦‚ä¸‹)

åˆ©ç”¨ GitHub è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ çš„ [ç¯å¢ƒå˜é‡](https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables)

å½“ GitHub Actions æ­£åœ¨è¿è¡Œè¿›ç¨‹æ—¶, `GITHUB_ACTIONS` ä¸º `true`

`GITHUB_REPOSITORY` ä¸º `<owner>/<repo>`

```js title="next.config.js"
const isGithubActions = process.env.GITHUB_ACTIONS || false

let assetPrefix = ''
let basePath = '/'

if (isGithubActions) {
  // å»æ‰ `<owner>/`
  const repo = process.env.GITHUB_REPOSITORY.replace(/.*?\//, '')

  assetPrefix = `/${repo}/`
  basePath = `/${repo}`
}

module.exports = {
  assetPrefix,
  basePath,
}
```

<br />

### 3.2 ä»¥ä¸‹ä¸ºå®Œæ•´çš„é…ç½®

```js title="next.config.js"
/** @type {import('next').NextConfig} */
// ç”¨äºä¸ºé™æ€èµ„æºï¼ˆå¦‚å›¾åƒã€æ ·å¼è¡¨ã€JavaScript æ–‡ä»¶ç­‰ï¼‰è®¾ç½® URL å‰ç¼€
// è¿™åœ¨å°†åº”ç”¨éƒ¨ç½²åˆ°è‡ªå®šä¹‰åŸŸåæˆ– CDN ä¸Šæ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨å°†é™æ€èµ„æºå­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®
let assetPrefix = `/${repo}/`

// ç”¨äºä¸ºåº”ç”¨è®¾ç½®åŸºç¡€è·¯å¾„
// è¿™åœ¨å°†åº”ç”¨éƒ¨ç½²åˆ°å­ç›®å½•ä¸‹æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨æŒ‡å®šåº”ç”¨æ‰€åœ¨çš„ç›®å½•
let basePath = `/${repo}`

const isGithubActions = process.env.GITHUB_ACTIONS || false

if (isGithubActions) {
  const repo = process.env.GITHUB_REPOSITORY.replace(/.*?\//, '')
  assetPrefix = `/${repo}/`
  basePath = `/${repo}`
}

const nextConfig = {
  assetPrefix,
  basePath,
  reactStrictMode: true,
  images: {
    unoptimized: true,
  },
}

module.exports = nextConfig
```
<br />













## ç¤ºä¾‹ä»£ç 

* [GitHub Repository](https://github.com/didilinkin/next-static-site-antd)

* [GitHub Pages é¢„è§ˆé¡µé¢](https://didilinkin.github.io/next-static-site-antd/)












## å¸¸è§é—®é¢˜

* `Error: The deploy step encountered an error: The process '/usr/bin/git' failed with exit code "128"  âŒ Notice: Deployment failed! âŒ`

  * [è§£å†³æ–¹æ¡ˆ: ä¿®æ”¹ `workflow permissions`](https://github.com/ad-m/github-push-action/issues/96#issuecomment-1396347833)

  * [è§£å†³æ–¹æ¡ˆ: ä¿®æ”¹ `workflow permissions`æƒé™](https://github.com/actions/checkout/issues/417#issuecomment-1427951779)

  ![](img/218471657.png)
<br />





















## å‚è€ƒé“¾æ¥

* [(ä¸»è¦å€Ÿé‰´) é˜®ä¸€å³° - GitHub Actions å…¥é—¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)
* [(ä¸»è¦å€Ÿé‰´) Using GitHub Pages to Build, Deploy, and Host Next.js](https://www.viget.com/articles/host-build-and-deploy-next-js-projects-on-github-pages/)
* [Using Composite GitHub Actions to make your Workflows smaller and more reusable](https://wallis.dev/blog/composite-github-actions)
* [GitHub Actions - Announcing the GitHub Actions extension for VS Code](https://github.blog/2023-03-28-announcing-the-github-actions-extension-for-vs-code/)
* [Deploying to Github Pages? Don't Forget to Fix Your Links](https://maximorlov.com/deploying-to-github-pages-dont-forget-to-fix-your-links/)
* [Automating build/deploy CI/CD with GitHub Actions](https://www.viget.com/articles/automating-build-deploy-ci-cd-with-github-actions/)
* [å¦‚ä½•ä½¿ç”¨ GitHub Actions å®ç°å¼€æºé¡¹ç›®çš„è‡ªåŠ¨åŒ–](https://www.freecodecamp.org/chinese/news/automate-open-source-projects-with-github-actions/)
