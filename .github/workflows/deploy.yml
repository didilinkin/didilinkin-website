name: Deploy CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18]

    steps:
      - name: è·å–æºç   ğŸ›ï¸
        uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: è®¾ç½® Node ğŸ—œï¸. Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v2-beta
        with:
          node-version: ${{ matrix.node-version }}

      # - run: npm install
      # - run: npm run build --if-present
      - name: ä½¿ç”¨ Yarn å®‰è£…ä¾èµ– âš™ï¸
        uses: borales/actions-yarn@v4
        with:
          cmd: install # will run `yarn install` command
        # env:
        #   NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }} # if needed

      - name: ä½¿ç”¨ Yarn æ‰“åŒ… ğŸ“¦
        uses: borales/actions-yarn@v4
        with:
          cmd: build # will run `yarn build:prod` command

      # ä½¿ç”¨ FTPæ–¹å¼:
      # - name: FTP Deploy
      #   uses: SamKirkland/FTP-Deploy-Action@4.0.0
      #   with:
      #     server: byu7172490001.my3w.com
      #     username: ${{ secrets.ftp_user }}
      #     password: ${{ secrets.ftp_pwd }}
      #     local-dir: ./build/
      #     server-dir: ./htdocs/
      #   env:
      #     CI: true

      # ä½¿ç”¨ SSH
      - name: ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½² ğŸš€
        uses: zhenyuWang/Upload-File-Action@v1.0.1
        with:
          username: ${{ secrets.SERVER_USERNAME }} # ç™»å½•è¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·å
          server: ${{ secrets.SERVER_ADDRESS }} # è¿œç¨‹æœåŠ¡å™¨ IP
          port: "22"
          ssh_private_key: ${{ secrets.SERVER_SSH_PRIVATE_KEY}}
          local_path: "./build/" # è¦ä¸Šä¼ æ–‡ä»¶æ‰€åœ¨ç›®å½•
          target_path: "/root/www/prod/home_page/html2" # è¿œç¨‹æœåŠ¡å™¨ç›®æ ‡è·¯å¾„
